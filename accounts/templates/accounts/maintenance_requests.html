{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Manager - Maintenance Requests</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
<div class="container mt-4">

    <h2 class="mb-4">Maintenance Requests</h2>
<p>Total requests in context: {{ requests.count }}</p>
<p>Debug: {{ requests }}</p>

    <!-- Stats -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card bg-warning text-white p-2">
                Pending: {{ stats.pending }}
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-info text-white p-2">
                In Progress: {{ stats.in_progress }}
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-white p-2">
                Completed: {{ stats.completed }}
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-danger text-white p-2">
                High Priority: {{ stats.high_priority }}
            </div>
        </div>
    </div>

    <!-- Filters -->
    <form method="get" class="row mb-3">
        <div class="col-md-3">
            <input type="text" name="search" class="form-control" placeholder="Search..." value="{{ search_query }}">
        </div>
        <div class="col-md-3">
            <select name="status" class="form-select">
                <option value="all" {% if current_status_filter == "all" %}selected{% endif %}>All Status</option>
                <option value="pending" {% if current_status_filter == "pending" %}selected{% endif %}>Pending</option>
                <option value="in_progress" {% if current_status_filter == "in_progress" %}selected{% endif %}>In Progress</option>
                <option value="completed" {% if current_status_filter == "completed" %}selected{% endif %}>Completed</option>
            </select>
        </div>
        <div class="col-md-3">
            <select name="priority" class="form-select">
                <option value="all" {% if current_priority_filter == "all" %}selected{% endif %}>All Priority</option>
                <option value="high" {% if current_priority_filter == "high" %}selected{% endif %}>High</option>
                <option value="medium" {% if current_priority_filter == "medium" %}selected{% endif %}>Medium</option>
                <option value="low" {% if current_priority_filter == "low" %}selected{% endif %}>Low</option>
            </select>
        </div>
        <div class="col-md-3">
            <button class="btn btn-primary w-100">Filter</button>
        </div>
    </form>

    <!-- Table -->
    <div class="table-responsive">
        <table class="table table-bordered table-hover">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Tenant</th>
                    <th>Unit</th>
                    <th>Issue</th>
                    <th>Priority</th>
                    <th>Status</th>
                    <th>Date Created</th>
                </tr>
            </thead>
            <tbody>
    {% for req in requests %}
    <tr>
        <td>{{ req.request_id }}</td>
        <td>{{ req.tenant.get_full_name|default:req.tenant.username }}</td>
        <td>{{ req.unit }}</td>
        <td>{{ req.issue_description }}</td>
        <td>
            {% if req.priority == "high" %}
                <span class="badge bg-danger">High</span>
            {% elif req.priority == "medium" %}
                <span class="badge bg-warning">Medium</span>
            {% else %}
                <span class="badge bg-success">Low</span>
            {% endif %}
        </td>
        <td>
            {% if req.status == "pending" %}
                <span class="badge bg-warning">Pending</span>
            {% elif req.status == "in_progress" %}
                <span class="badge bg-info">In Progress</span>
            {% else %}
                <span class="badge bg-success">Completed</span>
            {% endif %}
        </td>
        <td>{{ req.date_created|date:"M d, Y" }}</td>
    </tr>
    {% empty %}
    <tr>
        <td colspan="7" class="text-center">No maintenance requests found.</td>
    </tr>
    {% endfor %}
</tbody>


        </table>
    </div>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
</body>
</html>
